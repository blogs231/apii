<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASH Stream Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: #000;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
        }
        #player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }
        #web-ipTV {
            position: absolute;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            color: transparent;
            background: linear-gradient(to right, #ff007f, #ff7f00, #7fff00, #00ff7f, #007fff, #0000ff);
            background-clip: text;
            -webkit-background-clip: text;
            animation: text-gradient 5s infinite linear;
            text-align: center;
        }
        @keyframes text-gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        [data-shaka-player-container] {
            width: 100%;
            height: 100%;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 0;
            box-shadow: 0 0 25px var(--neon-color, #00f),
                        0 0 50px var(--neon-color, #00f),
                        0 0 75px var(--neon-color, #f0f);
            transition: box-shadow 0.2s ease;
        }
        .shaka-overflow-menu {
            background-color: rgb(41, 41, 163);
        }
        .shaka-spinner-container {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="player-container">
        <div id="web-ipTV">DASH Stream Player</div>
        <div data-shaka-player-container>
            <video data-shaka-player id="video" autoplay playsinline poster=""></video>
        </div>
    </div>

    <script>
        async function initPlayer() {
            const video = document.getElementById('video');
            const container = video.parentElement;
            const player = new shaka.Player(video);
            
            const config = {
                streaming: { 
                    rebufferingGoal: 1,
                    bufferingGoal: 3,
                    bufferBehind: 5,
                    autoLowLatencyMode: true,
                    lowLatencyMode: true,
                    jumpLargeGaps: true,
                    inaccurateManifestTolerance: 0.3,
                    stallEnabled: false,
                    retryParameters: { 
                        timeout: 30000,
                        maxAttempts: 3,
                        baseDelay: 1000,
                        backoffFactor: 2
                    }
                },
                manifest: { 
                    dash: { 
                        ignoreDrmInfo: true,
                        ignoreMinBufferTime: true,
                        autoCorrectDrift: true
                    }
                },
                abr: { 
                    enabled: true,
                    defaultBandwidthEstimate: 2000000
                },
                drm: {
                    clearKeys: { 
                        "f5d102ea74c6e686e1420773038a32c9": "3d27f8a3d818767c42a17e305320b6d4" 
                    }
                }
            };
            
            console.log('ClearKey DRM configured.');
            player.configure(config);

            const ui = new shaka.ui.Overlay(player, container, video);
            ui.configure({
                controlPanelElements: ["play_pause", "time_and_duration", "mute", "volume", "spacer", "quality", "picture_in_picture", "fullscreen"],
                volumeBarColors: { base: 'rgba(63, 187, 1, 1)', level: 'rgb(255, 69, 0)' },
                seekBarColors: { base: 'rgb(41, 41, 163)', buffered: 'rgb(35, 99, 3)', played: 'rgba(63, 187, 1, 1)' }
            });

            player.addEventListener('error', (event) => {
                console.error('Player error:', event.detail);
                alert('Player error: ' + event.detail.code + ' - ' + (event.detail.message || 'Unknown error.'));
            });

            try {
                await player.load("https://abmyxykaaaaaaaamkyvb65fuqebyg.7a77200bf98444ac997a89ed83775793.emt.cf.ww.aiv-cdn.net/iad-nitro/live/clients/dash/enc/hx4yfgqrc6/out/v1/219fea0a84a04c2086ed9c0c24272bbe/cenc.mpd");
                console.log('Stream loaded successfully.');
            } catch (error) {
                console.error('Error loading stream:', error);
                alert('Error loading stream: ' + error.message);
            }
        }

        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
